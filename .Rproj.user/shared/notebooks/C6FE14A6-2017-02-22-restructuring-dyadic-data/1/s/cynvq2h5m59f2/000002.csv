"0","dyad_pair <- dyad %>% "
"0","  gather(key,value,-dyad_id,-betw) %>% "
"0","  mutate(gender = ifelse(str_detect(key,""_h""),1,-1),"
"0","         key    = str_replace(key,""_w|_h"","""")) %>%"
"0","  spread(key,value) %>% "
"0","  split(.$dyad_id) %>% "
"0","  map_df(function(x){"
"0","    "
"0","    person1 <- x %>% "
"0","      mutate(act.par = ifelse(gender == 1,""a"",""p"")) %>% "
"0","      gather(key,value,-dyad_id,-betw,-act.par) %>% "
"0","      unite(key,key,act.par) %>% "
"0","      spread(key,value)"
"0","    "
"0","    person2 <- x %>% "
"0","      mutate(act.par = ifelse(gender == 1,""p"",""a"")) %>% "
"0","      gather(key,value,-dyad_id,-betw,-act.par) %>% "
"0","      unite(key,key,act.par) %>% "
"0","      spread(key,value)"
"0","    "
"0","    bind_rows(person1,person2)"
"0","  }) %>% "
"0","  mutate(partnum = ifelse(gender_a == 1,1,2)) %>% "
"0","  select(dyad_id,partnum,betw,ends_with(""_a""),ends_with(""_p""))"
